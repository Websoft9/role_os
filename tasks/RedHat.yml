- block:
  - name: Install Desktop
    shell: yum groupinstall -y 'Server with GUI'

  - name: Config Desktop
    shell: |
      systemctl set-default graphical.target
      systemctl isolate graphical.target
      systemctl get-default
  when: os_gui=="gnome"

- block: 
  - name: Create a random password for VNC
    set_fact: temp_password="{{ lookup('password', '/tmp/passwordfile length=8 chars=digits') }}"

  - name: delete tmp/passwordfile
    shell: rm -rf /tmp/passwordfile
  
  - name: Install VNC Server
    yum:
      name: [tigervnc-server]

  - name: clean
    shell: rm -rf /root/.vnc

  - name: vnc password
    expect:
      command: vncserver
      responses:
        "password": "{{temp_password}}"
        "Verify": "{{temp_password}}"
        "view-only": "n"
  
  - name: vnc service config
    copy:
      src: vncserver.service
      dest: /lib/systemd/system/vncserver@.service

  - name: VNC Server Start
    service:
      name: vncserver@:1.service
      enabled: yes
      state: started
      
  when: os_connection == 'vnc'
